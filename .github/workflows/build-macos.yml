name: Build macOS App

# Windows에서 개발 후 GitHub에 푸시하면 자동으로 macOS .dmg 파일 생성
# Artifacts에서 .dmg 다운로드 가능

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # 수동 실행 버튼 활성화

jobs:
  build-macos:
    name: Build macOS .app and .dmg
    runs-on: macos-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v4
    
    - name: Python 설정
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: 의존성 설치
      run: |
        cd MacOS
        pip install --upgrade pip
        pip install -r requirements_macos.txt
    
    - name: 빌드 스크립트 권한 부여
      run: |
        cd MacOS
        chmod +x build_all_mac.sh
    
    - name: .app 및 .dmg 빌드
      run: |
        cd MacOS
        ./build_all_mac.sh << EOF
        n
        EOF
    
    - name: 빌드 결과 확인
      run: |
        ls -lah MacOS/dist/
    
    - name: .dmg 파일 업로드
      uses: actions/upload-artifact@v4
      with:
        name: Woori-macOS-DMG
        path: MacOS/dist/*.dmg
        if-no-files-found: error
    
    - name: .app 파일 업로드
      uses: actions/upload-artifact@v4
      with:
        name: Woori-macOS-Apps
        path: MacOS/dist/*.app
        if-no-files-found: warn
